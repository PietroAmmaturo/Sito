<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Cosmin's secret project</title>
  <meta name="description"
        content="Advanced Hello World, WebXR! A-frame provides a hello world that is really remarkable, however you usually need to have controller selection and environment with movement.  With this example you get what works across the most headsets and controllers.">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="gray-translucent" />
  <!-- *** CHANGE THESE TO COMPONENTS ON YOUR SERVER *** -->
  <script src="scripts/aframe-v1.1.0.min.js"></script>
  <script src="scripts/aframe-extras.min.js"></script>
  <script src="scripts/aframe-teleport-controls.min.js"></script>
  <script src="scripts/aframe-thumb-controls-component.min.js"></script>

  <!-- for creating Navmesh... Also uncomment a-scene inspector-plugin-recast
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
    -->

</head>

<body>

  <!-- used for creating Navmesh... see javascript component above <a-scene inspector-plugin-recast>  https://github.com/donmccurdy/aframe-inspector-plugin-recast-->
  <a-scene background="color: #FAFAFA" shadow="type: basic" stats>

    <!-- assets to load -->
    <a-assets>
      <a-asset-item id="structure-obj" src="assets/obj/X20.obj"></a-asset-item>
      <a-asset-item id="structure-mtl" src="assets/obj/X20.mtl"></a-asset-item>
      <img id="canestra" src="assets/images/758px-Canestra_di_frutta_(Caravaggio).jpg">

    </a-assets>

    <a-sky color="#000000"></a-sky>

    <!-- Basic movement  -->
    <a-entity id="cameraRig" movement-controls="constrainToNavMesh: true;" position="0 0 0" rotation="0 0 0">
      <!-- camera -->
      <a-entity id="head" camera="active: true" position="0 1.6 0"
                look-controls="pointerLockEnabled: true; reverseMouseDrag: false">
        <a-entity id="cursor" cursor raycaster="far: 10; objects: .clickable" material="color: white; shader: flat"
                  position="0 0 -0.3" geometry="primitive: sphere; radius: 0.001">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- main structure -->
    <a-entity material="roughness: 1000; metalness: 0.5; shader: standard; color: white" raycaster-listen id="structure"
              class="clickable" obj-model="obj: #structure-obj" shadow="cast: true; receive: true" position="0 3.8 0"
              scale="1 1 1"></a-entity>
    <!-- floor -->
    <a-entity geometry="primitive: circle; segments: 256; radius: 26;" shadow="cast: true; receive: true"
              material="roughness: 0.7; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity: 0.1"
              radius="10" rotation="-90 0 0">
    </a-entity>
    <!-- b emitting -->
    <a-entity position="0.250 0 -0.8" geometry="height: 0.001; primitive: cylinder; segments-radial: 256; radius: 0.7;"
              shadow="cast: true; receive: true"
              material="roughness: 1; metalness: 1; shader: standard; color: white; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              rotation="0 0 0">
    </a-entity>
    <a-entity position="0.250 0 0.9" geometry="height: 0.001; primitive: cylinder; segments-radial: 256; radius: 0.7;"
              shadow="cast: true; receive: true"
              material="roughness: 1; metalness: 1; shader: standard; color: white; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              rotation="0 0 0">
    </a-entity>
    <a-entity position="-0.25 0 -0.8" geometry="height: 0.001; primitive: box; depth:1.4; width:1 "
              shadow="cast: true; receive: true"
              material="roughness: 1; metalness: 1; shader: standard; color: white; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              rotation="0 0 0">
    </a-entity>
    <a-entity position="-0.25 0 0.9" geometry="height: 0.001; primitive: box; depth:1.4; width:1 "
              shadow="cast: true; receive: true"
              material="roughness: 1; metalness: 1; shader: standard; color: white; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              rotation="0 0 0">
    </a-entity>
    <!-- wall emitting -->
    <a-entity position="0 3 0"
              geometry="height: 5; primitive: cylinder; segments-radial: 256; radius: 11.51; theta-length:15; theta-start:32; open-ended:true"
              material="side:double; roughness: 1; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              radius="10" rotation="0 0 0" shadow="cast: false; receive: true">
    </a-entity>
    <!-- wall emitting -->
    <a-entity position="0 3 0"
              geometry="height: 5; primitive: cylinder; segments-radial: 256; radius: 11.51; theta-length: 1; theta-start: 0; open-ended: false"
              material="side:double; roughness: 1; metalness: 1; shader: standard; color: white; emissive:#00AAFF; emissiveIntensity: 2"
              radius="30" rotation="0 0 0" shadow="cast: false; receive: true">
    </a-entity>
    <!-- rings -->
    <a-entity position="0 0.003 0"
              geometry="primitive: ring; segments-theta: 256; radius-inner:7.475; radius-outer:7.575;"
              material="roughness: 1; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              radius="10" rotation="-90 0 0">
    </a-entity>
    <a-entity position="0 0.1 0"
              geometry="primitive: ring; segments-theta: 256; radius-inner:11.105; radius-outer:11.205;"
              material="roughness: 1; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              radius="10" rotation="-90 0 0">
    </a-entity>
    <a-entity position="0 0.1 0"
              geometry="primitive: ring; segments-theta: 256; radius-inner:15.37; radius-outer:15.47;"
              material="roughness: 1; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              radius="10" rotation="-90 0 0">
    </a-entity>
    <a-entity position="0 0.1 0" geometry="primitive: ring; segments-theta: 256; radius-inner:19.80; radius-outer:19.9;"
              material="roughness: 1; metalness: 1; shader: standard; color: white; emissive:#FF8800; emissiveIntensity:1.2"
              radius="10" rotation="-90 0 0">
    </a-entity>
    <!-- nav-mesh: protecting us from running thru sphere, cube and cylinder  -->
    <a-entity position="0 3.8 0" id="navmesh" gltf-model="assets/gltf/navmesh.gltf" visible="false" nav-mesh>
    </a-entity>
    </a-entity>
    <!-- interactive img -->
    <a-image raycaster-listen onclick="clickImg(this);" onmouseenter="mouseenterImg(this);"
             onmouseleave="mouseleaveImg(this);" id="image_canestra" class="clickable" click-listener
             mouseenter-listener mouseleave-listener src="#canestra" position="2 1.5 -3" width="1" height="0.75"
             scale="1 1 1">
    </a-image>

    <!-- Lights in the scene -->
    <!--custom light | ambient -->
    <a-entity light="type: ambient;
    intensity: 0.1; color:  #F80;">
      <a-entity light="type:point;
    color:  #FF8800;
    intensity: 0.2;
    distance: 100;
    castShadow: true;
    decay: 0.2;
    shadowCameraNear: 6;
    shadowCameraVisible: false;" position="0 0 0">
      </a-entity>
    </a-entity>
    <!-- central lights -->
    <!-- bitcoin b (under)-->
    <a-entity light="type:spot;
    angle: 20;
    penumbra: 0;
    color:  #FF8800;
    intensity: 2;
    castShadow: false;
    decay: 1;
    shadowCameraVisible: false;" position="0 -10 0" rotation="90 0 0"></a-entity>
    <!--wall light-->
    <a-entity light="type:point;
    distance: 8;
    angle: 40;
    penumbra: 0;
    color:  #FF8800;
    intensity: 1;
    castShadow: false;
    decay: 1;
    shadowCameraVisible: false;" position="0 1 0" rotation="90 0 0"></a-entity>
    <!-- floor -->
    <a-entity light="type:spot;
        angle: 82;
        penumbra: 0.2;
        color:  #FF8800;
        intensity: 5;
        castShadow: false;
        decay: 0;
        shadowCameraVisible: false;" position="0 1 0" rotation="-90 0 0"></a-entity>
    <a-entity light="type:spot;
  distance: 20;
  angle: 70;
  penumbra: 0;
  color:  #FF8800;
  intensity: 4;
  castShadow: true;
  decay: 10;
  shadowCameraVisible: true; shadowMapHeight:5120; shadowMapWidth:5120" position="7.3 2 8.8" rotation="0 220 0">
    </a-entity>
  </a-scene>
  <script>


    // Component to do on click.
    AFRAME.registerComponent('click-listener', {
      init: function () {
        this.el.addEventListener('click', function (evt) {
          // remove clicked object from view
          //this.setAttribute('visible', false);

        });
      }
    });    // Component to do on click.
    AFRAME.registerComponent('mouseenter-listener', {
      init: function () {
        this.el.addEventListener('mouseenter', function (evt) {
          // remove clicked object from view
          //this.setAttribute('visible', false);

        });
      }
    });
    AFRAME.registerComponent('mouseleave-listener', {
      init: function () {
        this.el.addEventListener('mouseleave', function (evt) {
          // remove clicked object from view
          //this.setAttribute('visible', false);

        });
      }
    });



    function clickImg(image, link) {
      console.log("click started");
      window.open(link);
    }
    function mouseenterImg(image) {
      console.log("mouseenter started");
      image.setAttribute('scale', '1.2 1.2 1')
    }
    function mouseleaveImg(image) {
      console.log("mouseleave started");
      image.setAttribute('scale', '1 1 1')
    }

    AFRAME.registerComponent('raycaster-listen', {
      init: function () {
        // Use events to figure out what raycaster is listening so we don't have to
        // hardcode the raycaster.
        this.el.addEventListener('raycaster-intersected', evt => {
          console.log("raycaster-intersected", this.el);
          this.raycaster = evt.detail.el;

        });
        this.el.addEventListener('raycaster-intersected-cleared', evt => {
          console.log("raycaster-intersected-cleared", this.el);
          this.raycaster = null;
        });
      },

      tick: function () {
        if (!this.raycaster) { return; }  // Not intersecting.

        let intersection = this.raycaster.components.raycaster.getIntersection(this.el);
        if (!intersection) { return; }
      }
    });

    var sceneEl = document.querySelector('a-scene');

    AFRAME.registerComponent('do-something-once-loaded', {
      init: function () {
        // This will be called after the entity has properly attached and loaded.
        console.log('I am ready!');
      }
    });

    let frames = [
      {
        "title": "anything",
        "id": "frame1",
        "url": "assets/images/758px-Canestra_di_frutta_(Caravaggio).jpg",
        "height": "2",
        "thetaLength": "15",
        "radius": "10",
        "thetaStart": "100",
        "elevation": "2",
        "ctaUrl": "https://www.google.com/"
      },
      {
        "title": "anything",
        "id": "frame2",
        "url": "assets/images/758px-Canestra_di_frutta_(Caravaggio).jpg",
        "height": "4",
        "thetaLength": "30",
        "radius": "10",
        "thetaStart": "0",
        "elevation": "4",
        "ctaUrl": "https://www.google.com/"
      }
    ]

    function build_frames() {
      for (let frame of frames) {
        console.log(frame);
        var frameEl = document.createElement('a-curvedimage');
        sceneEl.appendChild(frameEl);
        frameEl.setAttribute('do-something-once-loaded',);
        frameEl.setAttribute('raycaster-listen',);
        frameEl.classList.add("clickable");
        frameEl.classList.add("ignore");
        frameEl.setAttribute('id', "'" + frame.id + "'");
        frameEl.setAttribute('position', { x: 0, y: frame.elevation, z: 0 });
        frameEl.setAttribute('radius', frame.radius);
        frameEl.setAttribute('theta-start', frame.thetaStart);
        frameEl.setAttribute('theta-length', frame.thetaLength);
        frameEl.setAttribute('height', frame.height);
        frameEl.setAttribute('src', frame.url);
        frameEl.setAttribute('onclick', "clickImg(this,\'" + frame.ctaUrl + "\')");
      }
    }

    if (sceneEl.hasLoaded) {
      build_frames();
    } else {
      sceneEl.addEventListener('loaded', build_frames);
    }


  </script>
</body>



</html>